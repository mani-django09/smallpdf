{% extends 'base.html' %}
{% load static %}

{% block title %}Merge PDF - Combine Multiple PDF Files Online Free | SmallPDF.us{% endblock %}

{% block meta %}
<meta name="description" content="Merge PDF files online free with SmallPDF.us - the best PDF merger tool. Combine multiple PDF files into one document. Fast, secure PDF merger online.">
<meta name="keywords" content="merge pdf, pdf merger, combine pdf files, pdf merger online, merge pdf online, pdf combine, smallpdf.us, online pdf merger">
<meta name="robots" content="index, follow">
<meta name="author" content="SmallPDF.us">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Open Graph Meta Tags -->
<meta property="og:title" content="Merge PDF - Best Online PDF Merger Tool | SmallPDF.us">
<meta property="og:description" content="Best PDF merger at SmallPDF.us. Merge PDF files online free, combine multiple PDFs into one. Professional PDF merger tool with instant results.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://smallpdf.us/merge-pdf">
<meta property="og:image" content="{% static 'images/merge-pdf-tool.jpg' %}">
<meta property="og:site_name" content="SmallPDF.us">

<!-- Twitter Card Meta Tags -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Merge PDF - Online PDF Merger Tool | SmallPDF.us">
<meta name="twitter:description" content="Professional PDF merger tool. Merge PDF files online free with SmallPDF.us - fastest PDF merger online.">
<meta name="twitter:image" content="{% static 'images/merge-pdf-tool.jpg' %}">

<!-- Structured Data -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "WebApplication",
  "name": "Merge PDF - SmallPDF.us",
  "description": "Free online PDF merger to merge PDF files, combine multiple PDFs into one document at SmallPDF.us",
  "url": "https://smallpdf.us/merge-pdf",
  "applicationCategory": "UtilitiesApplication",
  "operatingSystem": "Any",
  "offers": {
    "@type": "Offer",
    "price": "0",
    "priceCurrency": "USD"
  },
  "featureList": [
    "Merge PDF files online free",
    "PDF merger online", 
    "Combine multiple PDF files",
    "Batch PDF merging",
    "Mobile-optimized PDF merger",
    "Secure PDF combining"
  ],
  "provider": {
    "@type": "Organization",
    "name": "SmallPDF.us",
    "url": "https://smallpdf.us"
  }
}
</script>

<!-- Preload critical resources -->
<link rel="preload" href="{% static 'css/converter.css' %}" as="style">
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
{% endblock %}

{% block extra_css %}
<style>
    /* FIXED: CSS Variables and Base Styles */
    :root {
        --primary-color: #4361ee;
        --primary-dark: #3a0ca3;
        --success-color: #10b981;
        --error-color: #ef4444;
        --gray-50: #f8fafc;
        --gray-100: #f1f5f9;
        --gray-200: #e2e8f0;
        --gray-300: #cbd5e1;
        --gray-400: #94a3b8;
        --gray-500: #64748b;
        --gray-600: #475569;
        --gray-700: #334155;
        --gray-800: #1e293b;
        --gray-900: #0f172a;
        --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
        --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
        --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
        --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1);
    }

    * {
        box-sizing: border-box;
    }

    /* FIXED: Main Wrapper with Reduced Gap */
    .main-wrapper {
        min-height: 100vh;
        background: linear-gradient(135deg, var(--gray-50) 0%, var(--gray-200) 100%);
        padding: 0.5rem;
        margin-bottom: 0; /* FIXED: Remove bottom margin */
    }
    
    /* FIXED: Converter Container with Reduced Margin */
    .converter-container {
        max-width: 800px;
        margin: 0 auto 1rem auto; /* FIXED: Reduced bottom margin from large gap to 1rem */
        background: white;
        border-radius: 12px;
        box-shadow: var(--shadow-lg);
        overflow: hidden;
        border: 1px solid var(--gray-200);
    }

    /* Header */
    .tool-header {
        text-align: center;
        padding: 1.5rem 1rem;
        background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
        color: white;
        position: relative;
    }
    
    .tool-header h1 {
        font-size: 1.6rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
        line-height: 1.3;
    }
    
    .tool-header p {
        opacity: 0.9;
        font-size: 1rem;
        margin: 0;
        line-height: 1.4;
    }

    /* Content Area */
    .content-area {
        padding: 1.5rem;
    }

    /* Upload Area */
    .upload-area {
        border: 2px dashed var(--gray-300);
        border-radius: 12px;
        padding: 2rem 1rem;
        text-align: center;
        transition: all 0.3s ease;
        cursor: pointer;
        background: var(--gray-50);
        margin-bottom: 1rem;
    }
    
    .upload-area:hover, .upload-area.dragover {
        border-color: var(--primary-color);
        background: #f0f5ff;
        transform: translateY(-2px);
    }
    
    .upload-icon {
        width: 60px;
        height: 60px;
        background: rgba(67, 97, 238, 0.1);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 1rem;
        transition: transform 0.3s ease;
    }
    
    .upload-area:hover .upload-icon {
        transform: scale(1.1);
    }
    
    .upload-icon svg {
        width: 28px;
        height: 28px;
        color: var(--primary-color);
    }

    .upload-text h3 {
        font-size: 1.3rem;
        color: var(--gray-800);
        margin-bottom: 0.5rem;
        font-weight: 600;
    }
    
    .upload-text p {
        color: var(--gray-600);
        margin-bottom: 1rem;
        font-size: 1rem;
        line-height: 1.4;
    }
    
    .upload-btn {
        background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
        color: white;
        border: none;
        border-radius: 8px;
        padding: 0.8rem 1.5rem;
        font-weight: 600;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 12px rgba(67, 97, 238, 0.3);
    }
    
    .upload-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(67, 97, 238, 0.4);
    }

    /* File Container */
    .file-container {
        display: none;
    }

    .file-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
        flex-wrap: wrap;
        gap: 0.75rem;
    }

    .file-header h3 {
        font-size: 1.2rem;
        font-weight: 600;
        color: var(--gray-800);
        margin: 0;
        flex: 1;
        min-width: 150px;
    }

    .add-more-btn {
        font-size: 0.9rem;
        padding: 0.5rem 1rem;
        background: var(--gray-100);
        border: 1px solid var(--gray-300);
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        white-space: nowrap;
    }

    .add-more-btn:hover {
        background: var(--gray-200);
    }

    /* IMPROVED: PDF Preview Grid with Real Thumbnails */
    .pdf-preview-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
        gap: 1rem;
        margin-bottom: 1rem;
        max-height: 400px;
        overflow-y: auto;
        padding: 1rem;
        background: var(--gray-50);
        border-radius: 12px;
        border: 1px solid var(--gray-200);
    }

    .pdf-preview-item {
        background: white;
        border-radius: 12px;
        padding: 1rem;
        text-align: center;
        box-shadow: var(--shadow-sm);
        transition: all 0.3s ease;
        position: relative;
        cursor: pointer;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .pdf-preview-item:hover {
        transform: translateY(-4px);
        box-shadow: var(--shadow-md);
    }

    /* IMPROVED: Real PDF Thumbnail with PDF.js */
    .pdf-thumbnail {
        width: 100px;
        height: 130px;
        background: var(--gray-100);
        border-radius: 8px;
        margin-bottom: 0.75rem;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        border: 2px solid var(--gray-200);
        position: relative;
    }

    .pdf-thumbnail canvas {
        max-width: 100%;
        max-height: 100%;
        border-radius: 6px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .pdf-thumbnail-loading {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 0.7rem;
        color: var(--gray-500);
        text-align: center;
        padding: 0.25rem;
    }

    .pdf-thumbnail-error {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: var(--error-color);
        font-size: 0.7rem;
        text-align: center;
    }

    /* PDF File Info */
    .pdf-filename {
        font-size: 0.8rem;
        font-weight: 600;
        color: var(--gray-700);
        margin-bottom: 0.25rem;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        width: 100%;
        max-width: 120px;
    }

    .pdf-pages {
        font-size: 0.7rem;
        color: var(--gray-500);
        background: var(--gray-100);
        padding: 0.2rem 0.5rem;
        border-radius: 12px;
        display: inline-block;
    }

    .pdf-remove-btn {
        position: absolute;
        top: -8px;
        right: -8px;
        width: 24px;
        height: 24px;
        background: var(--error-color);
        color: white;
        border: none;
        border-radius: 50%;
        font-size: 0.8rem;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
        opacity: 0;
        box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);
    }

    .pdf-preview-item:hover .pdf-remove-btn {
        opacity: 1;
    }

    .pdf-remove-btn:hover {
        background: #dc2626;
        transform: scale(1.1);
    }

    /* Options Section */
    .options-section {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 1rem;
        margin: 1rem 0;
        padding: 1rem;
        background: var(--gray-50);
        border-radius: 12px;
        border: 1px solid var(--gray-200);
    }

    .option-group {
        display: flex;
        flex-direction: column;
    }

    .option-label {
        font-size: 0.9rem;
        font-weight: 600;
        color: var(--gray-700);
        margin-bottom: 0.5rem;
    }

    .option-select {
        padding: 0.6rem;
        border: 1px solid var(--gray-300);
        border-radius: 8px;
        font-size: 0.9rem;
        background: white;
        transition: all 0.2s ease;
    }

    .option-select:focus {
        border-color: var(--primary-color);
        outline: none;
        box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
    }

    /* Action Buttons */
    .action-buttons {
        display: flex;
        gap: 1rem;
        margin-top: 1rem;
    }

    .action-btn {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        padding: 0.8rem 1rem;
        border-radius: 8px;
        font-weight: 600;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
    }

    .secondary-btn {
        background: white;
        border: 2px solid var(--gray-300);
        color: var(--gray-600);
    }

    .secondary-btn:hover {
        background: var(--gray-50);
        color: var(--gray-700);
        border-color: var(--gray-400);
    }

    .primary-btn {
        background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
        color: white;
        border: none;
        box-shadow: 0 4px 12px rgba(67, 97, 238, 0.3);
    }

    .primary-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(67, 97, 238, 0.4);
    }

    .primary-btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
    }

    /* Loading Overlay */
    .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(15, 23, 42, 0.8);
        backdrop-filter: blur(4px);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        padding: 1rem;
    }

    .loading-content {
        background: white;
        border-radius: 16px;
        padding: 2rem 1.5rem;
        text-align: center;
        width: 100%;
        max-width: 320px;
        box-shadow: var(--shadow-xl);
        animation: slideInUp 0.3s ease-out;
    }

    @keyframes slideInUp {
        from {
            transform: translateY(50px);
            opacity: 0;
        }
        to {
            transform: translateY(0);
            opacity: 1;
        }
    }

    .loader {
        width: 40px;
        height: 40px;
        position: relative;
        margin: 0 auto 1rem;
    }

    .loader::before {
        content: '';
        position: absolute;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        border: 3px solid var(--gray-200);
        border-top: 3px solid var(--primary-color);
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .loading-progress {
        width: 100%;
        height: 6px;
        background: var(--gray-200);
        border-radius: 3px;
        margin: 1rem 0;
        overflow: hidden;
    }

    .progress-bar {
        width: 0%;
        height: 100%;
        background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
        border-radius: 3px;
        transition: width 0.3s ease;
    }

    /* Result Section */
    .pdf-result-section {
        display: none;
        margin-top: 1rem;
        padding: 1.5rem;
        background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
        border-radius: 12px;
        border: 2px solid #0ea5e9;
        animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
        from {
            transform: translateY(20px);
            opacity: 0;
        }
        to {
            transform: translateY(0);
            opacity: 1;
        }
    }

    .pdf-result-header {
        text-align: center;
        margin-bottom: 1rem;
    }

    .pdf-result-title {
        font-size: 1.3rem;
        font-weight: 700;
        color: var(--gray-900);
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
    }

    .success-icon {
        width: 24px;
        height: 24px;
        background: var(--success-color);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        animation: bounceIn 0.5s ease-out;
    }

    @keyframes bounceIn {
        0% { transform: scale(0); }
        50% { transform: scale(1.1); }
        100% { transform: scale(1); }
    }

    .pdf-info {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 1rem;
        margin-bottom: 1rem;
        padding: 1rem;
        background: rgba(255, 255, 255, 0.7);
        border-radius: 8px;
    }

    .pdf-info-item {
        text-align: center;
    }

    .pdf-info-label {
        font-size: 0.8rem;
        color: var(--gray-600);
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    .pdf-info-value {
        font-size: 1rem;
        font-weight: 700;
        color: var(--gray-900);
        margin-top: 0.25rem;
    }

    .download-section {
        display: flex;
        gap: 1rem;
    }

    .download-btn {
        flex: 2;
        background: linear-gradient(135deg, var(--success-color), #059669);
        color: white;
        border: none;
        border-radius: 8px;
        padding: 0.8rem 1rem;
        font-weight: 600;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    }

    .download-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
    }

    /* Messages */
    .message {
        padding: 0.8rem 1rem;
        border-radius: 8px;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.9rem;
        animation: slideIn 0.3s ease;
    }

    .message-error {
        background: #fef2f2;
        color: #dc2626;
        border-left: 4px solid #dc2626;
    }

    .message-success {
        background: #f0fdf4;
        color: #16a34a;
        border-left: 4px solid #16a34a;
    }

    .message-icon {
        width: 16px;
        height: 16px;
        flex-shrink: 0;
    }

    .file-input {
        display: none;
    }

    /* FIXED: Instructions Section - Reduced Gap and Spacing */
    .instructions-section {
        padding: 2rem 0; /* FIXED: Reduced from 5rem to 2rem */
        background-color: #f8fafc;
        margin-top: 0; /* FIXED: Ensure no extra margin */
    }
    
    .section-title {
        text-align: center;
        margin-bottom: 1.5rem; /* FIXED: Reduced from 3rem to 1.5rem */
    }
    
    .section-title h2 {
        font-size: 1.8rem; /* FIXED: Reduced from 2.2rem */
        color: #0b132b;
        font-weight: 700;
        margin-bottom: 0.75rem; /* FIXED: Reduced */
    }
    
    .section-title p {
        color: #64748b;
        max-width: 600px; /* FIXED: Reduced */
        margin: 0 auto;
        font-size: 1rem; /* FIXED: Reduced */
        line-height: 1.5; /* FIXED: Reduced */
    }
    
    .instruction-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1.5rem; /* FIXED: Reduced */
        max-width: 1000px; /* FIXED: Reduced */
        margin: 0 auto;
    }
    
    .instruction-card {
        background: white;
        border-radius: 12px;
        padding: 1.5rem; /* FIXED: Reduced */
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.05);
        position: relative;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        text-align: center;
    }
    
    .instruction-card:hover {
        transform: translateY(-3px); /* FIXED: Reduced */
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.1);
    }
    
    .instruction-icon {
        width: 44px; /* FIXED: Reduced */
        height: 44px; /* FIXED: Reduced */
        background: rgba(67, 97, 238, 0.1);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 1rem;
    }
    
    .instruction-icon svg {
        width: 20px;
        height: 20px;
        color: #4361ee;
    }
    
    .instruction-card h3 {
        font-size: 1.2rem; /* FIXED: Reduced */
        color: #0b132b;
        margin-bottom: 0.8rem; /* FIXED: Reduced */
        font-weight: 600;
    }
    
    .instruction-card p {
        color: #64748b;
        font-size: 0.95rem; /* FIXED: Reduced */
        line-height: 1.5; /* FIXED: Reduced */
    }

    /* Features Section */
    .features-section {
        padding: 3rem 0; /* FIXED: Reduced from 5rem */
        background: white;
        position: relative;
        overflow: hidden;
    }
    
    .features-section::before {
        content: '';
        position: absolute;
        top: 0;
        right: 0;
        width: 300px;
        height: 300px;
        background: rgba(67, 97, 238, 0.05);
        border-radius: 50%;
        transform: translate(100px, -150px);
        z-index: 0;
    }
    
    .features-section::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        width: 400px;
        height: 400px;
        background: rgba(58, 12, 163, 0.03);
        border-radius: 50%;
        transform: translate(-200px, 200px);
        z-index: 0;
    }
    
    .features-section .container {
        position: relative;
        z-index: 1;
    }
    
    .features-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 2rem; /* FIXED: Reduced */
        max-width: 1200px;
        margin: 0 auto;
    }
    
    .feature-card {
        background: #ffffff;
        border-radius: 16px;
        padding: 1.5rem; /* FIXED: Reduced */
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.04);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        position: relative;
        overflow: hidden;
        border: 1px solid rgba(67, 97, 238, 0.08);
    }
    
    .feature-card::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 3px;
        background: linear-gradient(90deg, #4361ee, #3a0ca3);
        transform: scaleX(0);
        transform-origin: left;
        transition: transform 0.3s ease;
    }
    
    .feature-card:hover {
        transform: translateY(-8px); /* FIXED: Reduced */
        box-shadow: 0 20px 40px rgba(67, 97, 238, 0.1);
    }
    
    .feature-card:hover::after {
        transform: scaleX(1);
    }
    
    .feature-card-icon-wrapper {
        margin-bottom: 1rem; /* FIXED: Reduced */
        position: relative;
    }
    
    .feature-card-icon {
        width: 52px; /* FIXED: Reduced */
        height: 52px; /* FIXED: Reduced */
        background: rgba(67, 97, 238, 0.08);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto;
        position: relative;
        z-index: 1;
        transition: all 0.3s ease;
    }
    
    .feature-card:hover .feature-card-icon {
        background: rgba(67, 97, 238, 0.12);
        transform: scale(1.05);
    }
    
    .feature-card-icon::before {
        content: '';
        position: absolute;
        width: 42px; /* FIXED: Reduced */
        height: 42px; /* FIXED: Reduced */
        border-radius: 50%;
        border: 2px dashed rgba(67, 97, 238, 0.2);
        animation: rotate 20s linear infinite;
    }
    
    @keyframes rotate {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    
    .feature-card-icon svg {
        width: 20px; /* FIXED: Reduced */
        height: 20px; /* FIXED: Reduced */
        color: #4361ee;
        transition: all 0.3s ease;
    }
    
    .feature-card:hover .feature-card-icon svg {
        transform: scale(1.1);
        color: #3a0ca3;
    }
    
    .feature-card h3 {
        font-size: 1.2rem; /* FIXED: Reduced */
        color: #0b132b;
        margin-bottom: 0.8rem; /* FIXED: Reduced */
        font-weight: 700;
        position: relative;
        display: inline-block;
    }
    
    .feature-card p {
        color: #64748b;
        font-size: 0.95rem; /* FIXED: Reduced */
        line-height: 1.6; /* FIXED: Reduced */
        max-width: 280px;
        margin: 0 auto;
    }

    /* FAQ Section Styles */
    .faq-section {
        padding: 3rem 0; /* FIXED: Reduced from 5rem */
        background-color: white;
    }

    .faq-container {
        max-width: 800px;
        margin: 0 auto;
    }
    
    .faq-item {
        border-bottom: 1px solid #e2e8f0;
        margin-bottom: 0;
    }

    .faq-item:last-child {
        border-bottom: none;
    }

    .faq-question {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1.2rem 0; /* FIXED: Reduced */
        font-size: 1rem; /* FIXED: Reduced */
        font-weight: 600;
        color: #0b132b;
        cursor: pointer;
        transition: color 0.3s ease;
    }

    .faq-question:hover {
        color: #4361ee;
    }

    .faq-question svg {
        width: 18px; /* FIXED: Reduced */
        height: 18px; /* FIXED: Reduced */
        color: #64748b;
        transition: transform 0.3s ease, color 0.3s ease;
        flex-shrink: 0;
        margin-left: 1rem;
    }

    .faq-question:hover svg {
        color: #4361ee;
    }

    .faq-item.active .faq-question svg {
        transform: rotate(180deg);
        color: #4361ee;
    }

    .faq-answer {
        padding: 0 0 1.2rem 0; /* FIXED: Reduced */
        display: none;
    }

    .faq-item.active .faq-answer {
        display: block;
    }

    .faq-answer p {
        color: #64748b;
        font-size: 0.95rem; /* FIXED: Reduced */
        line-height: 1.6; /* FIXED: Reduced */
        margin: 0;
    }

    /* SEO Content Section */
    .seo-content {
        padding: 3rem 0; /* FIXED: Reduced from 5rem */
        background-color: #f8fafc;
        background-image: linear-gradient(135deg, #f8fafc 0%, #eef2ff 100%);
        position: relative;
        border-top: 1px solid rgba(79, 70, 229, 0.1);
        border-bottom: 1px solid rgba(79, 70, 229, 0.1);
    }
    
    .seo-content::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 5px;
        height: 100%;
        background: linear-gradient(to bottom, #4361ee, #3a0ca3);
        border-radius: 0 2px 2px 0;
    }
    
    .seo-content .container {
        position: relative;
        padding-left: 2rem;
    }
    
    .seo-content h2 {
        font-size: 1.8rem; /* FIXED: Reduced */
        color: #0b132b;
        margin-bottom: 1.5rem; /* FIXED: Reduced */
        font-weight: 800;
        padding-left: 1.5rem;
        position: relative;
        display: inline-block;
    }
    
    .seo-content h2::after {
        content: '';
        position: absolute;
        bottom: -10px;
        left: 1.5rem;
        width: 80px;
        height: 4px;
        background: linear-gradient(90deg, #4361ee, #3a0ca3);
        border-radius: 2px;
    }   
    
    .seo-content h3 {
        font-size: 1.4rem; /* FIXED: Reduced */
        color: #0b132b;
        margin: 2rem 0 1rem; /* FIXED: Reduced */
        font-weight: 700;
        padding-left: 1.5rem;
        position: relative;
    }
    
    .seo-content h3::before {
        content: '';
        position: absolute;
        left: 0;
        top: 50%;
        transform: translateY(-50%);
        width: 8px;
        height: 8px;
        background: #4361ee;
        border-radius: 50%;
    }
      
    .seo-content p, .seo-content li {
        color: #475569;
        font-size: 1rem; /* FIXED: Reduced */
        line-height: 1.7; /* FIXED: Reduced */
        margin-bottom: 1rem; /* FIXED: Reduced */
        padding-left: 1.5rem;
    }
    
    .seo-content p:first-of-type {
        font-size: 1.1rem; /* FIXED: Reduced */
        color: #1e293b;
        font-weight: 500;
    }  
    
    .seo-content ul, .seo-content ol {
        margin-left: 3rem;
        margin-bottom: 1.5rem; /* FIXED: Reduced */
    }
    
    .seo-content li {
        margin-bottom: 0.6rem; /* FIXED: Reduced */
        position: relative;
    }
    
    .seo-content li strong {
        color: #3a0ca3;
        font-weight: 600;
    }

    .mini-cta-direct-fix {
        padding: 2rem 0; /* FIXED: Reduced from 3rem */
        background: linear-gradient(135deg, #4361ee, #3a0ca3);
        text-align: center;
        color: white;
        margin-bottom: 0;
        position: relative;
        z-index: 1;
    }
    
    .mini-cta-direct-fix h2 {
        font-size: 1.6rem; /* FIXED: Reduced */
        font-weight: 700;
        margin-bottom: 0.6rem; /* FIXED: Reduced */
    }
    
    .mini-cta-direct-fix p {
        font-size: 0.95rem; /* FIXED: Reduced */
        margin-bottom: 1.2rem; /* FIXED: Reduced */
        max-width: 600px; /* FIXED: Reduced */
        margin-left: auto;
        margin-right: auto;
        opacity: 0.9;
    }
    
    .cta-btn-direct {
        display: inline-block;
        background: white;
        color: #3a0ca3;
        font-weight: 600;
        padding: 0.7rem 1.8rem; /* FIXED: Reduced */
        border-radius: 8px;
        text-decoration: none;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }
    
    .cta-btn-direct:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
    }

    /* FIXED: Responsive Design */
    @media (max-width: 768px) {
        .main-wrapper {
            padding: 0.25rem;
        }
        
        .converter-container {
            margin: 0.25rem auto 0.5rem auto; /* FIXED: Further reduced margins */
        }
        
        .content-area {
            padding: 1rem;
        }
        
        .upload-area {
            padding: 1.5rem 1rem;
        }
        
        .upload-icon {
            width: 50px;
            height: 50px;
        }
        
        .upload-icon svg {
            width: 24px;
            height: 24px;
        }
        
        .upload-text h3 {
            font-size: 1.1rem;
        }
        
        .upload-text p {
            font-size: 0.9rem;
        }
        
        .upload-btn {
            padding: 0.7rem 1.2rem;
            font-size: 0.9rem;
            width: 100%;
            max-width: 220px;
        }
        
        .pdf-preview-grid {
            grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
            gap: 0.75rem;
        }    
        
        .pdf-thumbnail {
            width: 80px;
            height: 100px;
        }
        
        .file-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 0.75rem;
        }
        
        .action-buttons {
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .download-section {
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .options-section {
            grid-template-columns: 1fr;
            gap: 0.75rem;
        }
        
        .instruction-grid, .features-grid {
            grid-template-columns: 1fr;
            gap: 1rem;
        }
        
        .instruction-card, .feature-card {
            padding: 1.2rem;
        }
        
        .instructions-section {
            padding: 1.5rem 0; /* FIXED: Further reduced for mobile */
        }
        
        .features-section {
            padding: 2rem 0; /* FIXED: Further reduced for mobile */
        }
        
        .faq-section {
            padding: 2rem 0; /* FIXED: Further reduced for mobile */
        }
        
        .seo-content {
            padding: 2rem 0; /* FIXED: Further reduced for mobile */
        }
        
        .mini-cta-direct-fix {
            padding: 1.5rem 0; /* FIXED: Further reduced for mobile */
        }
    }
    
    @media (max-width: 480px) {
        .converter-container {
            margin: 0.25rem auto 0.25rem auto; /* FIXED: Minimal margins for small screens */
            border-radius: 8px;
        }
        
        .content-area {
            padding: 0.75rem;
        }
        
        .upload-area {
            padding: 1.2rem 0.75rem;
        }
        
        .pdf-preview-grid {
            grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
            gap: 0.5rem;
            padding: 0.75rem;
        }
        
        .pdf-thumbnail {
            width: 70px;
            height: 90px;
        }
        
        .tool-header {
            padding: 1.2rem 0.75rem;
        }
        
        .tool-header h1 {
            font-size: 1.3rem;
        }
        
        .tool-header p {
            font-size: 0.85rem;
        }
        
        .instructions-section {
            padding: 1rem 0; /* FIXED: Minimal padding for very small screens */
        }
        
        .features-section {
            padding: 1.5rem 0; /* FIXED: Minimal padding for very small screens */
        }
        
        .section-title h2 {
            font-size: 1.5rem;
        }
        
        .section-title p {
            font-size: 0.9rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="main-wrapper">
    <div class="converter-container">
        <!-- Header -->
        <div class="tool-header">
            <h1>Merge PDF - SmallPDF.us</h1>
            <p>Best PDF merger online - Merge PDF files free with SmallPDF.us professional tool</p>
        </div>

        <!-- Main Content -->
        <div class="content-area">
            <!-- Upload Area -->
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="17 8 12 3 7 8"></polyline>
                        <line x1="12" y1="3" x2="12" y2="15"></line>
                    </svg>
                </div>
                <div class="upload-text">
                    <h3>Upload PDF Files to Merge</h3>
                    <p>Use SmallPDF.us PDF merger<br>Drag & drop or click to browse</p>
                    <button class="upload-btn" id="selectFileBtn">Select PDF Files</button>
                </div>
                <input type="file" id="fileInput" class="file-input" accept=".pdf,application/pdf" multiple>
            </div>

            <!-- File Preview Container -->
            <div class="file-container" id="fileContainer">
                <div class="file-header">
                    <h3>Selected PDF Files</h3>
                    <button class="add-more-btn" id="addMoreBtn">
                        <svg width="16" height="16" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                        </svg>
                        Add More
                    </button>
                </div>

                <!-- PDF Preview Grid -->
                <div class="pdf-preview-grid" id="pdfPreviewGrid">
                    <!-- PDF files will be populated here -->
                </div>

                <!-- Options Section -->
                <div class="options-section">
                    <div class="option-group">
                        <label class="option-label" for="mergeOrder">Merge Order</label>
                        <select class="option-select" id="mergeOrder">
                            <option value="upload" selected>Upload Order</option>
                            <option value="alphabetical">Alphabetical</option>
                            <option value="custom">Custom Order</option>
                        </select>
                    </div>
                    
                    <div class="option-group">
                        <label class="option-label" for="outputQuality">Quality</label>
                        <select class="option-select" id="outputQuality">
                            <option value="high" selected>High</option>
                            <option value="medium">Medium</option>
                            <option value="low">Low</option>
                        </select>
                    </div>
                    
                    <div class="option-group">
                        <label class="option-label" for="pageRange">Page Range</label>
                        <select class="option-select" id="pageRange">
                            <option value="all" selected>All Pages</option>
                            <option value="custom">Custom Range</option>
                        </select>
                    </div>
                    
                    <div class="option-group">
                        <label class="option-label" for="bookmarks">Bookmarks</label>
                        <select class="option-select" id="bookmarks">
                            <option value="preserve" selected>Preserve</option>
                            <option value="create">Create New</option>
                            <option value="remove">Remove</option>
                        </select>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="action-buttons">
                    <button class="action-btn secondary-btn" id="clearBtn">
                        <svg width="16" height="16" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                        </svg>
                        Clear All
                    </button>
                    <button class="action-btn primary-btn" id="mergeBtn">
                        <svg width="16" height="16" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        Merge PDFs
                    </button>
                </div>
            </div>

            <!-- PDF Result Section -->
            <div class="pdf-result-section" id="pdfResultSection">
                <div class="pdf-result-header">
                    <h2 class="pdf-result-title">
                        <div class="success-icon">
                            <svg style="width: 14px; height: 14px; color: white;" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7" />
                            </svg>
                        </div>
                        PDF Merge Success!
                    </h2>
                    <p style="color: #64748b; font-size: 1rem; margin: 0;">SmallPDF.us merged your PDFs perfectly</p>
                </div>

                <div class="pdf-info" id="pdfInfo">
                    <div class="pdf-info-item">
                        <div class="pdf-info-label">Files</div>
                        <div class="pdf-info-value" id="totalFiles">-</div>
                    </div>
                    <div class="pdf-info-item">
                        <div class="pdf-info-label">Pages</div>
                        <div class="pdf-info-value" id="totalPages">-</div>
                    </div>
                    <div class="pdf-info-item">
                        <div class="pdf-info-label">Size</div>
                        <div class="pdf-info-value" id="fileSize">-</div>
                    </div>
                    <div class="pdf-info-item">
                        <div class="pdf-info-label">Quality</div>
                        <div class="pdf-info-value" id="qualityInfo">-</div>
                    </div>
                </div>

                <div class="download-section">
                    <button class="download-btn" id="downloadPdfBtn">
                        <svg width="18" height="18" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        Download Merged PDF
                    </button>
                    <button class="action-btn secondary-btn" id="startOverBtn" style="flex: 1;">
                        <svg width="16" height="16" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                        </svg>
                        Merge More
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Loading Overlay -->
<div class="loading-overlay" id="loadingOverlay">
    <div class="loading-content">
        <div class="loader"></div>
        <h3 style="font-size: 1.1rem; font-weight: 600; color: #1e293b; margin-bottom: 0.5rem;">Merging PDFs...</h3>
        <p style="color: #64748b; margin-bottom: 1rem; font-size: 1rem;">SmallPDF.us processing your files</p>
        <div class="loading-progress">
            <div class="progress-bar" id="progressBar"></div>
        </div>
        <p style="font-size: 0.8rem; color: #64748b; margin: 0.5rem 0 0;" id="loadingStatus">Preparing...</p>
    </div>
</div>

<!-- Instructions Section -->
<section class="instructions-section">
    <div class="container">
        <div class="section-title">
            <h2>How to Use SmallPDF.us PDF Merger</h2>
            <p>Learn how to merge PDF files online free with SmallPDF.us - the best PDF merger tool for professional results</p>
        </div>
        
        <div class="instruction-grid">
            <div class="instruction-card">
                <div class="instruction-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                    </svg>
                </div>
                <h3>1. Upload PDF Files</h3>
                <p>Select multiple PDF files to merge using SmallPDF.us PDF merger. Upload all PDFs you want to combine into one document.</p>
            </div>
            
            <div class="instruction-card">
                <div class="instruction-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="22" y1="12" x2="18" y2="12"></line>
                        <line x1="6" y1="12" x2="2" y2="12"></line>
                        <line x1="12" y1="6" x2="12" y2="2"></line>
                        <line x1="12" y1="22" x2="12" y2="18"></line>
                    </svg>
                </div>
                <h3>2. Configure PDF Merger Settings</h3>
                <p>Customize your PDF merging with SmallPDF.us options. Choose merge order, quality settings, and other preferences for perfect results.</p>
            </div>
            
            <div class="instruction-card">
                <div class="instruction-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="2" y="3" width="6" height="18" rx="1"></rect>
                        <rect x="9" y="3" width="6" height="18" rx="1"></rect>
                        <rect x="16" y="3" width="6" height="18" rx="1"></rect>
                    </svg>
                </div>
                <h3>3. Download Merged PDF</h3>
                <p>Complete your PDF merge and download your combined document. SmallPDF.us PDF merger ensures high-quality results every time.</p>
            </div>
        </div>
    </div>
</section>

<!-- Enhanced Features Section -->
<section class="features-section" id="features">
    <div class="container">
        <div class="section-title">
            <h2>Why SmallPDF.us is the Best PDF Merger Online</h2>
            <p>Discover why SmallPDF.us is the top choice for PDF merging - the most advanced PDF merger tool available</p>
        </div>
        
        <div class="features-grid">
            <!-- Card 1: Unlimited Merging -->
            <div class="feature-card">
                <div class="feature-card-icon-wrapper">
                    <div class="feature-card-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="3" y1="9" x2="21" y2="9"></line>
                            <line x1="9" y1="21" x2="9" y2="9"></line>
                        </svg>
                    </div>
                </div>
                <h3>Unlimited PDF Merging</h3>
                <p>SmallPDF.us PDF merger allows unlimited file combinations. Merge as many PDFs as needed with our powerful online tool.</p>
            </div>
            
            <!-- Card 2: Perfect Quality -->
            <div class="feature-card">
                <div class="feature-card-icon-wrapper">
                    <div class="feature-card-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                            <polyline points="22 4 12 14.01 9 11.01"></polyline>
                        </svg>
                    </div>
                </div>
                <h3>Professional PDF Quality</h3>
                <p>SmallPDF.us PDF merger delivers professional-grade results. Merge PDFs with perfect quality and formatting preservation.</p>
            </div>
            
            <!-- Card 3: 100% Secure -->
            <div class="feature-card">
                <div class="feature-card-icon-wrapper">
                    <div class="feature-card-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                        </svg>
                    </div>
                </div>
                <h3>Secure PDF Merger</h3>
                <p>SmallPDF.us protects your privacy during PDF merging. All uploaded files are encrypted and automatically deleted after processing.</p>
            </div>
            
            <!-- Card 4: Cloud Processing -->
            <div class="feature-card">
                <div class="feature-card-icon-wrapper">
                    <div class="feature-card-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"></path>
                        </svg>
                    </div>
                </div>
                <h3>Cloud-Based Merger</h3>
                <p>SmallPDF.us cloud technology enables fast PDF merging without using your device's resources. Works on any platform.</p>
            </div>
            
            <!-- Card 5: Smart Preview -->
            <div class="feature-card">
                <div class="feature-card-icon-wrapper">
                    <div class="feature-card-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                        </svg>
                    </div>
                </div>
                <h3>Smart PDF Processing</h3>
                <p>Preview your merged PDF document before downloading to ensure everything looks perfect. Navigate through pages to verify content and layout.</p>
                </div>
            
            <!-- Card 6: Free Tool -->
            <div class="feature-card">
                <div class="feature-card-icon-wrapper">
                    <div class="feature-card-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path>
                            <line x1="7" y1="7" x2="7.01" y2="7"></line>
                        </svg>
                    </div>
                </div>
                <h3>Free PDF Merger</h3>
                <p>Merge PDFs completely free with SmallPDF.us. No hidden costs, no watermarks, no registration required for our PDF merger.</p>
            </div>
        </div>
    </div>
</section>

<!-- SEO Content Section -->
<section class="seo-content">
    <div class="container">
        <h2>SmallPDF.us - The Best PDF Merger Online</h2>
        <p>SmallPDF.us is the leading platform to <strong>merge PDF files</strong> online with professional results. Our advanced <strong>PDF merger</strong> allows you to effortlessly combine multiple PDF documents into one file. Whether you need a simple <strong>PDF merger tool</strong> or a powerful <strong>online PDF merger</strong>, SmallPDF.us delivers exceptional quality and speed for all your merging needs.</p>
        
        <h3>Why Choose SmallPDF.us PDF Merger Online?</h3>
        <p>When you need to <strong>merge PDF files</strong>, SmallPDF.us stands out as the premier choice among online tools. Our <strong>PDF merger</strong> combines cutting-edge technology with user-friendly design to deliver superior results. Here's what makes SmallPDF.us the best <strong>online PDF merger</strong>:</p>
        <ul>
            <li><strong>Advanced PDF Merging Technology:</strong> SmallPDF.us uses proprietary algorithms to ensure perfect PDF merging while maintaining original document quality</li>
            <li><strong>Batch Processing:</strong> Merge multiple PDF files simultaneously with our powerful PDF merger tool</li>
            <li><strong>Custom Merge Settings:</strong> Choose merge order, quality settings, and page ranges for perfect results</li>
            <li><strong>Mobile Optimized:</strong> SmallPDF.us PDF merger works perfectly on all devices and browsers</li>
            <li><strong>Free PDF Merging:</strong> No hidden costs or watermarks with our online PDF merger</li>
            <li><strong>Professional Quality:</strong> Maintain document formatting and quality during the merge process</li>
        </ul>
        
        <h3>Professional PDF Merging for Every Need</h3>
        <p>SmallPDF.us serves professionals, students, and individuals who need reliable <strong>PDF merging</strong>. Our versatile <strong>online PDF merger</strong> handles diverse requirements, from simple document combinations to complex merging projects:</p>
        <ol>
            <li><strong>Business Documentation:</strong> Merge PDF reports, contracts, and presentations with SmallPDF.us PDF merger</li>
            <li><strong>Academic Projects:</strong> Use our PDF merger to combine research papers, thesis chapters, and study materials</li>
            <li><strong>Legal Documents:</strong> Our online PDF merger helps combine contracts, agreements, and legal briefs</li>
            <li><strong>Financial Reports:</strong> Merge PDF statements, invoices, and financial documents using SmallPDF.us</li>
            <li><strong>Project Management:</strong> Combine PDF project files, specifications, and documentation with our PDF merger</li>
            <li><strong>Personal Organization:</strong> Merge PDF receipts, manuals, and personal documents using SmallPDF.us online tool</li>
        </ol>
        
        <h3>How SmallPDF.us Creates Perfect Merged PDFs</h3>
        <p>Our advanced <strong>online PDF merger</strong> uses intelligent processing to create optimized merged documents without sacrificing quality. When you <strong>merge PDF files</strong> with SmallPDF.us, our system analyzes each document and applies optimal settings to ensure your merged PDFs are:</p>
        <ul>
            <li><strong>Perfectly Organized:</strong> SmallPDF.us maintains proper page order and document structure</li>
            <li><strong>High Quality:</strong> Our PDF merger preserves original document clarity and formatting</li>
            <li><strong>Optimally Sized:</strong> Merged PDFs from our tool are optimized for sharing and storage</li>
            <li><strong>Bookmark Preserved:</strong> Original bookmarks and navigation are maintained when merging PDFs</li>
            <li><strong>Cross-Compatible:</strong> Merged documents open perfectly on any device or PDF reader</li>
        </ul>
    </div>
</section>

<!-- FAQ Section -->
<section class="faq-section">
    <div class="container">
        <div class="section-title">
            <h2>PDF Merger FAQ - SmallPDF.us</h2>
            <p>Get answers about SmallPDF.us PDF merger - the best online PDF merger tool</p>
        </div>
        
        <div class="faq-container">
            <div class="faq-item">
                <div class="faq-question">
                    How do I merge PDF files online free with SmallPDF.us?
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                </div>
                <div class="faq-answer">
                    <p>To merge PDF files with SmallPDF.us PDF merger, simply upload your PDF files using our free online tool. Choose your preferred settings, then click "Merge PDFs". Your PDF merging will be completed instantly.</p>
                </div>
            </div>
            
            <div class="faq-item">
                <div class="faq-question">
                    Why is SmallPDF.us the best PDF merger online?
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                </div>
                <div class="faq-answer">
                    <p>SmallPDF.us offers the most advanced PDF merger with batch processing, custom merge orders, quality settings, and professional output. Our PDF merger maintains high file quality while creating optimized documents.</p>
                </div>
            </div>
            
            <div class="faq-item">
                <div class="faq-question">
                    Can I merge multiple large PDF files with SmallPDF.us?
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                </div>
                <div class="faq-answer">
                    <p>Yes! SmallPDF.us PDF merger supports large file merging. Upload multiple PDFs up to 100MB each and merge them efficiently. Our cloud processing handles large files smoothly.</p>
                </div>
            </div>
            
            <div class="faq-item">
                <div class="faq-question">
                    Is SmallPDF.us PDF merger secure and private?
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                </div>
                <div class="faq-answer">
                    <p>Absolutely. SmallPDF.us uses SSL encryption for all PDF merging operations. Your PDF files are automatically deleted after processing, and we never access or store your documents. Merge PDFs with complete privacy.</p>
                </div>
            </div>
            
            <div class="faq-item">
                <div class="faq-question">
                    What file formats does SmallPDF.us PDF merger support?
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                </div>
                <div class="faq-answer">
                    <p>SmallPDF.us PDF merger works exclusively with PDF files. To merge other document types, first convert them to PDF using our other tools, then use the PDF merger to combine them.</p>
                </div>
            </div>
            
            <div class="faq-item">
                <div class="faq-question">
                    How fast is SmallPDF.us PDF merging process?
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                </div>
                <div class="faq-answer">
                    <p>SmallPDF.us PDF merger processes files in seconds. Our optimized cloud servers ensure lightning-fast PDF merging, making our tool the fastest PDF merger solution available online.</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Fixed Mini CTA Section -->
<section class="mini-cta-direct-fix">
    <div class="container">
        <h2>Try Our Other PDF Tools</h2>
        <p>SmallPDF.us offers a complete suite of tools to handle all your PDF needs</p>
        <a href="{% url 'all_tools' %}" class="cta-btn-direct">Explore All Tools</a>
    </div>
</section>

{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // IMPROVED JavaScript with Real PDF Thumbnails and Fixed Gap Issues
    
    // Initialize PDF.js
    if (typeof pdfjsLib !== 'undefined') {
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    }
    
    // DOM Elements
    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('fileInput');
    const selectFileBtn = document.getElementById('selectFileBtn');
    const fileContainer = document.getElementById('fileContainer');
    const pdfPreviewGrid = document.getElementById('pdfPreviewGrid');
    const addMoreBtn = document.getElementById('addMoreBtn');
    const clearBtn = document.getElementById('clearBtn');
    const mergeBtn = document.getElementById('mergeBtn');
    const loadingOverlay = document.getElementById('loadingOverlay');
    const pdfResultSection = document.getElementById('pdfResultSection');
    const downloadPdfBtn = document.getElementById('downloadPdfBtn');
    const startOverBtn = document.getElementById('startOverBtn');
    const progressBar = document.getElementById('progressBar');
    const loadingStatus = document.getElementById('loadingStatus');
    
    // Options elements
    const mergeOrder = document.getElementById('mergeOrder');
    const outputQuality = document.getElementById('outputQuality');
    const pageRange = document.getElementById('pageRange');
    const bookmarks = document.getElementById('bookmarks');
    
    // State variables
    let selectedFiles = [];
    let isMerging = false;
    let mergedPdfBlob = null;
    let mergeSettings = {};

    // FIXED: Get CSRF token from multiple sources
    function getCSRFToken() {
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        function getCSRFFromMeta() {
            const meta = document.querySelector('meta[name="csrf-token"]');
            return meta ? meta.getAttribute('content') : null;
        }

        function getCSRFFromInput() {
            const input = document.querySelector('input[name="csrfmiddlewaretoken"]');
            return input ? input.value : null;
        }

        return getCookie('csrftoken') || getCSRFFromMeta() || getCSRFFromInput() || '';
    }

    // Event Listeners
    if (selectFileBtn) {
        selectFileBtn.addEventListener('click', () => fileInput.click());
    }
    if (addMoreBtn) {
        addMoreBtn.addEventListener('click', () => fileInput.click());
    }
    if (fileInput) {
        fileInput.addEventListener('change', handleFileSelection);
    }
    if (clearBtn) {
        clearBtn.addEventListener('click', clearAllFiles);
    }
    if (mergeBtn) {
        mergeBtn.addEventListener('click', mergePDFs);
    }
    if (downloadPdfBtn) {
        downloadPdfBtn.addEventListener('click', downloadPDF);
    }
    if (startOverBtn) {
        startOverBtn.addEventListener('click', startOver);
    }

    // Drag and drop functionality
    if (uploadArea) {
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            uploadArea.addEventListener(eventName, preventDefaults, { passive: false });
        });

        ['dragenter', 'dragover'].forEach(eventName => {
            uploadArea.addEventListener(eventName, () => uploadArea.classList.add('dragover'), { passive: true });
        });

        ['dragleave', 'drop'].forEach(eventName => {
            uploadArea.addEventListener(eventName, () => uploadArea.classList.remove('dragover'), { passive: true });
        });

        uploadArea.addEventListener('drop', handleDrop, { passive: false });
    }

    function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
    }

    function handleDrop(e) {
        const dt = e.dataTransfer;
        const files = dt.files;
        handleFiles(files);
    }

    function handleFileSelection(e) {
        const files = e.target.files;
        if (files && files.length > 0) {
            handleFiles(files);
            fileInput.value = '';
        }
    }

    function handleFiles(files) {
        const validFiles = [];
        const maxFileSize = 100 * 1024 * 1024; // 100MB
        const maxFiles = 20;

        if (selectedFiles.length + files.length > maxFiles) {
            showMessage(`Maximum ${maxFiles} PDF files allowed.`, 'error');
            return;
        }

        for (let file of files) {
            if (file.type !== 'application/pdf' && !file.name.toLowerCase().endsWith('.pdf')) {
                showMessage(`Invalid format: ${file.name}. Only PDF files allowed.`, 'error');
                continue;
            }

            if (file.size > maxFileSize) {
                showMessage(`File too large: ${file.name}. Maximum 100MB per file.`, 'error');
                continue;
            }

            const isDuplicate = selectedFiles.some(existingFile => 
                existingFile.name === file.name && existingFile.size === file.size
            );

            if (isDuplicate) {
                showMessage(`Already selected: ${file.name}`, 'error');
                continue;
            }

            validFiles.push(file);
        }

        if (validFiles.length === 0) return;

        selectedFiles = selectedFiles.concat(validFiles);
        updateFilePreview();
        showFileContainer();

        if (validFiles.length > 0) {
            showMessage(`Added ${validFiles.length} PDF file${validFiles.length > 1 ? 's' : ''}.`, 'success');
        }
    }

    // IMPROVED: Real PDF Thumbnail Generation using PDF.js
    async function generatePDFThumbnail(file, index) {
        if (typeof pdfjsLib === 'undefined') {
            console.warn('PDF.js not loaded, falling back to placeholder');
            return null;
        }

        try {
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument({data: arrayBuffer}).promise;
            const page = await pdf.getPage(1);
            
            const scale = 0.5;
            const viewport = page.getViewport({scale: scale});
            
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            canvas.height = viewport.height;
            canvas.width = viewport.width;
            
            const renderContext = {
                canvasContext: context,
                viewport: viewport
            };
            
            await page.render(renderContext).promise;
            
            return {
                canvas: canvas,
                pageCount: pdf.numPages
            };
        } catch (error) {
            console.error('Error generating PDF thumbnail:', error);
            return null;
        }
    }

    function updateFilePreview() {
        if (!pdfPreviewGrid) return;
        
        pdfPreviewGrid.innerHTML = '';

        selectedFiles.forEach(async (file, index) => {
            const fileItem = document.createElement('div');
            fileItem.className = 'pdf-preview-item';
            fileItem.draggable = true;

            // Create initial HTML structure
            fileItem.innerHTML = `
                <div class="pdf-thumbnail" id="thumbnail_${index}">
                    <div class="pdf-thumbnail-loading">Generating preview...</div>
                </div>
                <div class="pdf-filename" title="${file.name}">${file.name}</div>
                <div class="pdf-pages" id="pages_${index}">Loading...</div>
                <button class="pdf-remove-btn" onclick="removeFile(${index}); event.stopPropagation();" aria-label="Remove ${file.name}"></button>
            `;

            pdfPreviewGrid.appendChild(fileItem);
            
            // Generate real PDF thumbnail
            try {
                const thumbnailData = await generatePDFThumbnail(file, index);
                const thumbnailContainer = document.getElementById(`thumbnail_${index}`);
                const pagesElement = document.getElementById(`pages_${index}`);
                
                if (thumbnailData && thumbnailContainer) {
                    // Clear loading message and add canvas
                    thumbnailContainer.innerHTML = '';
                    thumbnailContainer.appendChild(thumbnailData.canvas);
                    
                    // Update page count
                    if (pagesElement) {
                        pagesElement.textContent = `${thumbnailData.pageCount} page${thumbnailData.pageCount > 1 ? 's' : ''}`;
                    }
                } else {
                    // Fallback to PDF icon if thumbnail generation fails
                    if (thumbnailContainer) {
                        thumbnailContainer.innerHTML = `
                            <div class="pdf-thumbnail-error">
                                <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="#4361ee" stroke-width="2">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                    <polyline points="14 2 14 8 20 8"></polyline>
                                    <line x1="16" y1="13" x2="8" y2="13"></line>
                                    <line x1="16" y1="17" x2="8" y2="17"></line>
                                    <polyline points="10 9 9 9 8 9"></polyline>
                                </svg>
                            </div>
                        `;
                    }
                    
                    // Estimate pages based on file size
                    if (pagesElement) {
                        const estimatedPages = Math.max(1, Math.round(file.size / (50 * 1024)));
                        pagesElement.textContent = `~${estimatedPages} page${estimatedPages > 1 ? 's' : ''}`;
                    }
                }
            } catch (error) {
                console.error('Error updating PDF preview:', error);
                
                // Fallback display
                const thumbnailContainer = document.getElementById(`thumbnail_${index}`);
                const pagesElement = document.getElementById(`pages_${index}`);
                
                if (thumbnailContainer) {
                    thumbnailContainer.innerHTML = `
                        <div class="pdf-thumbnail-error">PDF Preview Error</div>
                    `;
                }
                
                if (pagesElement) {
                    const estimatedPages = Math.max(1, Math.round(file.size / (50 * 1024)));
                    pagesElement.textContent = `~${estimatedPages} page${estimatedPages > 1 ? 's' : ''}`;
                }
            }
        });
    }

    window.removeFile = function(index) {
        selectedFiles.splice(index, 1);
        updateFilePreview();

        if (selectedFiles.length === 0) {
            showUploadArea();
        }
    };

    function clearAllFiles() {
        selectedFiles = [];
        showUploadArea();
        hidePdfResult();
        showMessage('All files cleared.', 'success');
    }

    function startOver() {
        selectedFiles = [];
        mergedPdfBlob = null;
        mergeSettings = {};
        showUploadArea();
        hidePdfResult();
        clearMessages();
    }

    function updateProgress(percentage, status) {
        if (progressBar) progressBar.style.width = percentage + '%';
        if (loadingStatus) loadingStatus.textContent = status;
    }

    function mergePDFs() {
        if (!selectedFiles || selectedFiles.length < 2) {
            showMessage('Please select at least 2 PDF files to merge.', 'error');
            return;
        }

        if (isMerging) return;

        isMerging = true;
        if (mergeBtn) mergeBtn.disabled = true;
        showLoading();

        // Store merge settings
        mergeSettings = {
            merge_order: mergeOrder ? mergeOrder.value : 'upload',
            output_quality: outputQuality ? outputQuality.value : 'high',
            page_range: pageRange ? pageRange.value : 'all',
            bookmarks: bookmarks ? bookmarks.value : 'preserve'
        };

        // Progress simulation
        let progress = 0;
        const progressInterval = setInterval(() => {
            progress += Math.random() * 15;
            if (progress > 85) {
                progress = 85;
                clearInterval(progressInterval);
            }
            
            let status = 'Preparing files...';
            if (progress > 20) status = 'Validating PDFs...';
            if (progress > 40) status = 'Processing documents...';
            if (progress > 60) status = 'Merging pages...';
            if (progress > 75) status = 'Finalizing...';
            
            updateProgress(progress, status);
        }, 200);

        // Create FormData
        const formData = new FormData();
        
        // Add CSRF token
        const csrfToken = getCSRFToken();
        if (csrfToken) {
            formData.append('csrfmiddlewaretoken', csrfToken);
        }
        
        // Add PDF files
        selectedFiles.forEach((file, index) => {
            console.log(`Adding file ${index + 1}: ${file.name} (${file.size} bytes)`);
            formData.append('files', file);
        });
        
        // Add settings
        Object.keys(mergeSettings).forEach(key => {
            formData.append(key, mergeSettings[key]);
        });

        // Debug log
        console.log('Sending merge request:', {
            fileCount: selectedFiles.length,
            settings: mergeSettings,
            endpoint: '/api/merge-pdf/',
            hasCSRF: !!csrfToken
        });

        // Prepare headers
        const headers = {};
        if (csrfToken) {
            headers['X-CSRFToken'] = csrfToken;
        }

        // Send merge request
        fetch('/api/merge-pdf/', {
            method: 'POST',
            body: formData,
            headers: headers,
            credentials: 'same-origin'
        })
        .then(response => {
            clearInterval(progressInterval);
            updateProgress(95, 'Processing response...');
            
            console.log('Response received:', {
                status: response.status,
                statusText: response.statusText,
                contentType: response.headers.get('content-type'),
                contentLength: response.headers.get('content-length')
            });
            
            if (!response.ok) {
                return response.text().then(text => {
                    console.error('Error response:', text);
                    
                    let errorMessage = 'Merge failed. Please try again.';
                    
                    try {
                        const errorData = JSON.parse(text);
                        errorMessage = errorData.error || errorMessage;
                        if (errorData.details) {
                            errorMessage += '\n\nDetails: ' + errorData.details;
                        }
                    } catch (e) {
                        if (text.includes('<!DOCTYPE html>')) {
                            errorMessage = `Server error (${response.status}). Check server logs for details.`;
                        } else {
                            errorMessage = text.substring(0, 200);
                        }
                    }
                    
                    throw new Error(errorMessage);
                });
            }
            
            // Verify content type
            const contentType = response.headers.get('content-type');
            if (!contentType || !contentType.includes('application/pdf')) {
                throw new Error(`Expected PDF but received: ${contentType || 'unknown content type'}`);
            }
            
            return response.blob();
        })
        .then(blob => {
            if (!blob || blob.size === 0) {
                throw new Error('Received empty PDF file.');
            }
            
            console.log(`PDF merge successful: ${(blob.size / 1024 / 1024).toFixed(2)} MB`);
            
            mergedPdfBlob = blob;
            updateProgress(100, 'Complete!');
            
            setTimeout(() => {
                hideLoading();
                showPdfResult();
                updatePdfInfo();
                showMessage('PDFs merged successfully!', 'success');
            }, 500);
        })
        .catch(error => {
            clearInterval(progressInterval);
            hideLoading();
            
            console.error('Merge error:', error);
            showMessage(error.message, 'error');
        })
        .finally(() => {
            isMerging = false;
            if (mergeBtn) mergeBtn.disabled = false;
        });
    }

    function updatePdfInfo() {
        const totalFilesElement = document.getElementById('totalFiles');
        const totalPagesElement = document.getElementById('totalPages');
        const fileSizeElement = document.getElementById('fileSize');
        const qualityInfoElement = document.getElementById('qualityInfo');

        if (totalFilesElement) {
            totalFilesElement.textContent = selectedFiles.length;
        }

        if (totalPagesElement) {
            // Sum up estimated pages
            const totalPages = selectedFiles.reduce((sum, file) => {
                const estimatedPages = Math.max(1, Math.round(file.size / (50 * 1024)));
                return sum + estimatedPages;
            }, 0);
            totalPagesElement.textContent = totalPages;
        }

        if (fileSizeElement && mergedPdfBlob) {
            fileSizeElement.textContent = formatFileSize(mergedPdfBlob.size);
        }

        if (qualityInfoElement && mergeSettings.output_quality) {
            qualityInfoElement.textContent = mergeSettings.output_quality.charAt(0).toUpperCase() + mergeSettings.output_quality.slice(1);
        }
    }

    function downloadPDF() {
        if (!mergedPdfBlob) {
            showMessage('No merged PDF available for download.', 'error');
            return;
        }

        const url = window.URL.createObjectURL(mergedPdfBlob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'merged_document.pdf';
        
        document.body.appendChild(a);
        a.click();
        window.URL.revokeObjectURL(url);
        document.body.removeChild(a);

        showMessage('Merged PDF downloaded successfully!', 'success');
    }

    function showFileContainer() {
        if (uploadArea) uploadArea.style.display = 'none';
        if (fileContainer) fileContainer.style.display = 'block';
    }

    function showUploadArea() {
        if (uploadArea) uploadArea.style.display = 'block';
        if (fileContainer) fileContainer.style.display = 'none';
    }

    function showLoading() {
        if (loadingOverlay) {
            loadingOverlay.style.display = 'flex';
            updateProgress(0, 'Preparing...');
        }
    }

    function hideLoading() {
        if (loadingOverlay) {
            loadingOverlay.style.display = 'none';
        }
    }

    function showPdfResult() {
        if (pdfResultSection) pdfResultSection.style.display = 'block';
        if (fileContainer) fileContainer.style.display = 'none';
    }

    function hidePdfResult() {
        if (pdfResultSection) pdfResultSection.style.display = 'none';
    }

    function formatFileSize(bytes) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }

    function showMessage(message, type = 'error') {
        clearMessages();
        
        const messageDiv = document.createElement('div');
        messageDiv.className = `message message-${type}`;
        
        const iconSvg = type === 'error' ? 
            `<svg class="message-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="12"></line>
                <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>` :
            `<svg class="message-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                <polyline points="22 4 12 14.01 9 11.01"></polyline>
            </svg>`;
        
        messageDiv.innerHTML = `${iconSvg}<span>${message}</span>`;
        
        const contentArea = document.querySelector('.content-area');
        if (contentArea) {
            contentArea.insertBefore(messageDiv, contentArea.firstChild);
            
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.remove();
                }
            }, 5000);
        }
    }

    function clearMessages() {
        const messages = document.querySelectorAll('.message');
        messages.forEach(msg => msg.remove());
    }

    // Initialize FAQ functionality
    const faqItems = document.querySelectorAll('.faq-item');
    faqItems.forEach(item => {
        const question = item.querySelector('.faq-question');
        if (question) {
            question.addEventListener('click', () => {
                // Close all other FAQ items
                faqItems.forEach(otherItem => {
                    if (otherItem !== item) {
                        otherItem.classList.remove('active');
                    }
                });
                
                // Toggle current item
                item.classList.toggle('active');
            });
        }
    });

    // Initialize lazy loading for images
    const lazyImages = document.querySelectorAll('.lazy-load');
    if ('IntersectionObserver' in window) {
        const imageObserver = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('loaded');
                    observer.unobserve(entry.target);
                }
            });
        });

        lazyImages.forEach(img => imageObserver.observe(img));
    } else {
        // Fallback for older browsers
        lazyImages.forEach(img => img.classList.add('loaded'));
    }

    // Initialize smooth scrolling for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });

    // Performance optimization: Debounce window resize events
    let resizeTimeout;
    window.addEventListener('resize', () => {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(() => {
            // Trigger any resize-dependent functions here if needed
            console.log('Window resized');
        }, 250);
    }, { passive: true });

    // Initialize drag and drop sorting for PDF files
    function initializeSortable() {
        if (!pdfPreviewGrid) return;
        
        let draggedElement = null;
        
        pdfPreviewGrid.addEventListener('dragstart', function(e) {
            if (e.target.classList.contains('pdf-preview-item')) {
                draggedElement = e.target;
                e.target.style.opacity = '0.5';
            }
        });
        
        pdfPreviewGrid.addEventListener('dragend', function(e) {
            if (e.target.classList.contains('pdf-preview-item')) {
                e.target.style.opacity = '';
                draggedElement = null;
            }
        });
        
        pdfPreviewGrid.addEventListener('dragover', function(e) {
            e.preventDefault();
        });
        
        pdfPreviewGrid.addEventListener('drop', function(e) {
            e.preventDefault();
            
            if (draggedElement && e.target.classList.contains('pdf-preview-item')) {
                const dropTarget = e.target;
                
                // Get the indices
                const draggedIndex = Array.from(pdfPreviewGrid.children).indexOf(draggedElement);
                const dropIndex = Array.from(pdfPreviewGrid.children).indexOf(dropTarget);
                
                if (draggedIndex !== dropIndex) {
                    // Reorder the files array
                    const draggedFile = selectedFiles[draggedIndex];
                    selectedFiles.splice(draggedIndex, 1);
                    selectedFiles.splice(dropIndex, 0, draggedFile);
                    
                    // Update the preview
                    updateFilePreview();
                    
                    showMessage('File order updated', 'success');
                }
            }
        });
    }

    // Initialize error handling for PDF.js
    function handlePDFError(error, fileName) {
        console.error(`PDF processing error for ${fileName}:`, error);
        showMessage(`Error processing ${fileName}. File may be corrupted.`, 'error');
    }

    // Memory management for file previews
    function cleanupFileUrls() {
        // Clean up any blob URLs if used
        if (window.mergedPdfBlob) {
            URL.revokeObjectURL(window.mergedPdfBlob);
        }
    }

    // Cleanup on page unload
    window.addEventListener('beforeunload', cleanupFileUrls);

    // Enhanced error handling for mobile browsers
    window.addEventListener('error', function(e) {
        console.error('Global error:', e.error);
    }, { passive: true });

    window.addEventListener('unhandledrejection', function(e) {
        console.error('Unhandled promise rejection:', e.reason);
    }, { passive: true });

    // Initialize touch optimizations for mobile
    let isTouch = false;
    document.addEventListener('touchstart', function() {
        isTouch = true;
        document.body.classList.add('touch-device');
    }, { once: true, passive: true });

    // Optimize for mobile touch interactions
    if ('ontouchstart' in window) {
        document.body.classList.add('touch-device');
    }

    // Add viewport meta tag optimization for mobile if not present
    if (!document.querySelector('meta[name="viewport"]')) {
        const viewport = document.createElement('meta');
        viewport.name = 'viewport';
        viewport.content = 'width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes';
        document.head.appendChild(viewport);
    }

    // Preload critical resources for better performance
    function preloadCriticalResources() {
        const criticalUrls = [
            '/api/merge-pdf/',
            // Add other critical API endpoints here
        ];
        
        criticalUrls.forEach(url => {
            const link = document.createElement('link');
            link.rel = 'dns-prefetch';
            link.href = url;
            document.head.appendChild(link);
        });
    }

    // Service Worker registration for offline functionality (optional)
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/sw.js').then(function(registration) {
            console.log('ServiceWorker registration successful with scope: ', registration.scope);
        }, function(err) {
            console.log('ServiceWorker registration failed: ', err);
        });
    }

    // Advanced file validation
    function validatePDFFile(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const arrayBuffer = e.target.result;
                const uint8Array = new Uint8Array(arrayBuffer);
                
                // Check PDF header
                const pdfHeader = '%PDF-';
                const headerBytes = uint8Array.slice(0, 5);
                const headerString = String.fromCharCode.apply(null, headerBytes);
                
                if (headerString === pdfHeader) {
                    resolve(true);
                } else {
                    reject(new Error('Invalid PDF file format'));
                }
            };
            
            reader.onerror = function() {
                reject(new Error('Error reading file'));
            };
            
            // Read only the first 1024 bytes for validation
            reader.readAsArrayBuffer(file.slice(0, 1024));
        });
    }

    // Enhanced file processing with validation
    async function processFileWithValidation(file) {
        try {
            await validatePDFFile(file);
            return true;
        } catch (error) {
            showMessage(`Invalid PDF: ${file.name}`, 'error');
            return false;
        }
    }

    // Initialize sortable functionality
    initializeSortable();

    // Initialize critical resource preloading
    preloadCriticalResources();

    // Initialize the application
    showUploadArea();
    
    // Log initialization complete
    console.log('PDF Merger initialized successfully');
    console.log('Features enabled:', {
        pdfjs: typeof pdfjsLib !== 'undefined',
        serviceWorker: 'serviceWorker' in navigator,
        intersectionObserver: 'IntersectionObserver' in window,
        touchSupport: 'ontouchstart' in window
    });
});

// Additional utility functions
function debounce(func, wait, immediate) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            timeout = null;
            if (!immediate) func(...args);
        };
        const callNow = immediate && !timeout;
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
        if (callNow) func(...args);
    };
}

function throttle(func, limit) {
    let inThrottle;
    return function() {
        const args = arguments;
        const context = this;
        if (!inThrottle) {
            func.apply(context, args);
            inThrottle = true;
            setTimeout(() => inThrottle = false, limit);
        }
    };
}

// Performance monitoring
function measurePerformance(name, fn) {
    const start = performance.now();
    const result = fn();
    const end = performance.now();
    console.log(`${name} took ${end - start} milliseconds`);
    return result;
}

// Browser compatibility checks
function checkBrowserCompatibility() {
    const features = {
        fileAPI: !!(window.File && window.FileReader && window.FileList && window.Blob),
        dragDrop: 'draggable' in document.createElement('span'),
        canvas: !!document.createElement('canvas').getContext,
        webWorkers: typeof Worker !== 'undefined',
        promises: typeof Promise !== 'undefined',
        fetch: typeof fetch !== 'undefined'
    };
    
    const unsupported = Object.keys(features).filter(key => !features[key]);
    
    if (unsupported.length > 0) {
        console.warn('Unsupported browser features:', unsupported);
        showMessage('Some features may not work in your browser. Please use a modern browser for the best experience.', 'error');
    }
    
    return features;
}

// Initialize browser compatibility check
checkBrowserCompatibility();

// Export functions for testing (if needed)
if (typeof module !== 'undefined' && module.exports) {
    module.exports = {
        debounce,
        throttle,
        measurePerformance,
        checkBrowserCompatibility
    };
}
</script>
{% endblock %}